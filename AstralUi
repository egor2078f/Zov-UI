local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local Library = {}

--// Настройки Дизайна //--
local Theme = {
	MainFrame = Color3.fromRGB(35, 35, 35), -- Основной фон
	Header = Color3.fromRGB(45, 45, 45),    -- Шапка
	Element = Color3.fromRGB(50, 50, 50),   -- Фон элементов
	Hover = Color3.fromRGB(60, 60, 60),     -- Цвет при наведении
	Accent = Color3.fromRGB(0, 120, 215),   -- Акцентный цвет (синий)
	Text = Color3.fromRGB(240, 240, 240),   -- Цвет текста
	SubText = Color3.fromRGB(170, 170, 170),-- Доп. текст
	Font = Enum.Font.GothamBold,
	CornerRadius = UDim.new(0, 6)           -- Закругление углов
}

--// Вспомогательная функция для скругления //--
local function AddCorner(instance, radius)
	local corner = Instance.new("UICorner")
	corner.CornerRadius = radius or Theme.CornerRadius
	corner.Parent = instance
	return corner
end

--// Вспомогательная функция для перетаскивания (Draggable) //--
local function MakeDraggable(topbarobject, object)
	local Dragging = nil
	local DragInput = nil
	local DragStart = nil
	local StartPosition = nil

	local function Update(input)
		local Delta = input.Position - DragStart
		object.Position = UDim2.new(StartPosition.X.Scale, StartPosition.X.Offset + Delta.X, StartPosition.Y.Scale, StartPosition.Y.Offset + Delta.Y)
	end

	topbarobject.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			Dragging = true
			DragStart = input.Position
			StartPosition = object.Position

			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					Dragging = false
				end
			end)
		end
	end)

	topbarobject.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			DragInput = input
		end
	end)

	UserInputService.InputChanged:Connect(function(input)
		if input == DragInput and Dragging then
			Update(input)
		end
	end)
end

--// Основная функция создания окна //--
function Library:CreateWindow(titleText)
	local ScreenGui = Instance.new("ScreenGui")
	ScreenGui.Name = "WizardInspirationLib"
	ScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
	ScreenGui.ResetOnSpawn = false

	local MainFrame = Instance.new("Frame")
	MainFrame.Name = "MainFrame"
	MainFrame.Size = UDim2.new(0, 500, 0, 350) -- Размер окна
	MainFrame.Position = UDim2.new(0.5, -250, 0.5, -175)
	MainFrame.BackgroundColor3 = Theme.MainFrame
	MainFrame.BorderSizePixel = 0
	MainFrame.Parent = ScreenGui
	AddCorner(MainFrame)

	local Header = Instance.new("Frame")
	Header.Name = "Header"
	Header.Size = UDim2.new(1, 0, 0, 40)
	Header.BackgroundColor3 = Theme.Header
	Header.BorderSizePixel = 0
	Header.Parent = MainFrame
	AddCorner(Header)
	
	-- Исправление углов снизу у хедера, чтобы не были круглыми
	local HeaderFix = Instance.new("Frame")
	HeaderFix.Size = UDim2.new(1, 0, 0, 10)
	HeaderFix.Position = UDim2.new(0, 0, 1, -10)
	HeaderFix.BackgroundColor3 = Theme.Header
	HeaderFix.BorderSizePixel = 0
	HeaderFix.Parent = Header

	local Title = Instance.new("TextLabel")
	Title.Text = titleText or "UI Library"
	Title.Size = UDim2.new(1, -20, 1, 0)
	Title.Position = UDim2.new(0, 15, 0, 0)
	Title.BackgroundTransparency = 1
	Title.TextColor3 = Theme.Text
	Title.Font = Theme.Font
	Title.TextSize = 18
	Title.TextXAlignment = Enum.TextXAlignment.Left
	Title.Parent = Header

	MakeDraggable(Header, MainFrame)

	-- Контейнер для элементов
	local Container = Instance.new("ScrollingFrame")
	Container.Name = "Container"
	Container.Size = UDim2.new(1, -20, 1, -50)
	Container.Position = UDim2.new(0, 10, 0, 45)
	Container.BackgroundTransparency = 1
	Container.ScrollBarThickness = 4
	Container.ScrollBarImageColor3 = Theme.Accent
	Container.Parent = MainFrame
	
	local UIListLayout = Instance.new("UIListLayout")
	UIListLayout.Padding = UDim.new(0, 8)
	UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
	UIListLayout.Parent = Container

	local UIPadding = Instance.new("UIPadding")
	UIPadding.PaddingTop = UDim.new(0, 5)
	UIPadding.PaddingLeft = UDim.new(0, 5)
	UIPadding.PaddingRight = UDim.new(0, 5)
	UIPadding.Parent = Container

	-- Авто-ресайз скроллинга
	UIListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
		Container.CanvasSize = UDim2.new(0, 0, 0, UIListLayout.AbsoluteContentSize.Y + 10)
	end)

	local Window = {}

	--// Элемент: Label (Текст) //--
	function Window:Label(text)
		local LabelFrame = Instance.new("Frame")
		LabelFrame.Size = UDim2.new(1, 0, 0, 25)
		LabelFrame.BackgroundTransparency = 1
		LabelFrame.Parent = Container

		local LabelText = Instance.new("TextLabel")
		LabelText.Size = UDim2.new(1, 0, 1, 0)
		LabelText.BackgroundTransparency = 1
		LabelText.Text = text
		LabelText.TextColor3 = Theme.SubText
		LabelText.Font = Theme.Font
		LabelText.TextSize = 14
		LabelText.TextXAlignment = Enum.TextXAlignment.Left
		LabelText.Parent = LabelFrame
	end

	--// Элемент: Button (Кнопка) //--
	function Window:Button(text, callback)
		local BtnFrame = Instance.new("Frame")
		BtnFrame.Size = UDim2.new(1, 0, 0, 35)
		BtnFrame.BackgroundColor3 = Theme.Element
		BtnFrame.Parent = Container
		AddCorner(BtnFrame)

		local Btn = Instance.new("TextButton")
		Btn.Size = UDim2.new(1, 0, 1, 0)
		Btn.BackgroundTransparency = 1
		Btn.Text = text
		Btn.TextColor3 = Theme.Text
		Btn.Font = Theme.Font
		Btn.TextSize = 14
		Btn.Parent = BtnFrame

		Btn.MouseEnter:Connect(function()
			TweenService:Create(BtnFrame, TweenInfo.new(0.3), {BackgroundColor3 = Theme.Hover}):Play()
		end)
		Btn.MouseLeave:Connect(function()
			TweenService:Create(BtnFrame, TweenInfo.new(0.3), {BackgroundColor3 = Theme.Element}):Play()
		end)
		Btn.MouseButton1Click:Connect(function()
			-- Эффект нажатия
			TweenService:Create(BtnFrame, TweenInfo.new(0.1), {Size = UDim2.new(1, -4, 0, 31)}):Play()
			wait(0.1)
			TweenService:Create(BtnFrame, TweenInfo.new(0.1), {Size = UDim2.new(1, 0, 0, 35)}):Play()
			if callback then callback() end
		end)
	end

	--// Элемент: Toggle (Переключатель) //--
	function Window:Toggle(text, default, callback)
		local Toggled = default or false
		
		local ToggleFrame = Instance.new("Frame")
		ToggleFrame.Size = UDim2.new(1, 0, 0, 35)
		ToggleFrame.BackgroundColor3 = Theme.Element
		ToggleFrame.Parent = Container
		AddCorner(ToggleFrame)

		local Title = Instance.new("TextLabel")
		Title.Size = UDim2.new(0.7, 0, 1, 0)
		Title.Position = UDim2.new(0, 10, 0, 0)
		Title.BackgroundTransparency = 1
		Title.Text = text
		Title.TextColor3 = Theme.Text
		Title.Font = Theme.Font
		Title.TextSize = 14
		Title.TextXAlignment = Enum.TextXAlignment.Left
		Title.Parent = ToggleFrame

		local SwitchBg = Instance.new("Frame")
		SwitchBg.Size = UDim2.new(0, 40, 0, 20)
		SwitchBg.Position = UDim2.new(1, -50, 0.5, -10)
		SwitchBg.BackgroundColor3 = Toggled and Theme.Accent or Color3.fromRGB(80, 80, 80)
		SwitchBg.Parent = ToggleFrame
		AddCorner(SwitchBg, UDim.new(1, 0)) -- Полностью круглый

		local SwitchCircle = Instance.new("Frame")
		SwitchCircle.Size = UDim2.new(0, 16, 0, 16)
		SwitchCircle.Position = Toggled and UDim2.new(1, -18, 0.5, -8) or UDim2.new(0, 2, 0.5, -8)
		SwitchCircle.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
		SwitchCircle.Parent = SwitchBg
		AddCorner(SwitchCircle, UDim.new(1, 0))

		local Btn = Instance.new("TextButton")
		Btn.Size = UDim2.new(1, 0, 1, 0)
		Btn.BackgroundTransparency = 1
		Btn.Text = ""
		Btn.Parent = ToggleFrame

		Btn.MouseButton1Click:Connect(function()
			Toggled = not Toggled
			local targetPos = Toggled and UDim2.new(1, -18, 0.5, -8) or UDim2.new(0, 2, 0.5, -8)
			local targetColor = Toggled and Theme.Accent or Color3.fromRGB(80, 80, 80)
			
			TweenService:Create(SwitchCircle, TweenInfo.new(0.2), {Position = targetPos}):Play()
			TweenService:Create(SwitchBg, TweenInfo.new(0.2), {BackgroundColor3 = targetColor}):Play()
			
			if callback then callback(Toggled) end
		end)
	end
	
	--// Элемент: Checkbox (Флажок) //--
	function Window:Checkbox(text, default, callback)
		local Checked = default or false
		
		local CheckFrame = Instance.new("Frame")
		CheckFrame.Size = UDim2.new(1, 0, 0, 35)
		CheckFrame.BackgroundColor3 = Theme.Element
		CheckFrame.Parent = Container
		AddCorner(CheckFrame)
		
		local Title = Instance.new("TextLabel")
		Title.Size = UDim2.new(0.7, 0, 1, 0)
		Title.Position = UDim2.new(0, 10, 0, 0)
		Title.BackgroundTransparency = 1
		Title.Text = text
		Title.TextColor3 = Theme.Text
		Title.Font = Theme.Font
		Title.TextSize = 14
		Title.TextXAlignment = Enum.TextXAlignment.Left
		Title.Parent = CheckFrame
		
		local BoxOutline = Instance.new("Frame")
		BoxOutline.Size = UDim2.new(0, 20, 0, 20)
		BoxOutline.Position = UDim2.new(1, -30, 0.5, -10)
		BoxOutline.BackgroundColor3 = Color3.fromRGB(30,30,30)
		BoxOutline.BorderColor3 = Theme.Accent
		BoxOutline.BorderSizePixel = 1
		BoxOutline.Parent = CheckFrame
		AddCorner(BoxOutline, UDim.new(0, 4))
		
		local InnerCheck = Instance.new("Frame")
		InnerCheck.Size = UDim2.new(1, -4, 1, -4)
		InnerCheck.Position = UDim2.new(0, 2, 0, 2)
		InnerCheck.BackgroundColor3 = Theme.Accent
		InnerCheck.BackgroundTransparency = Checked and 0 or 1
		InnerCheck.Parent = BoxOutline
		AddCorner(InnerCheck, UDim.new(0, 3))
		
		local Btn = Instance.new("TextButton")
		Btn.Size = UDim2.new(1, 0, 1, 0)
		Btn.BackgroundTransparency = 1
		Btn.Text = ""
		Btn.Parent = CheckFrame
		
		Btn.MouseButton1Click:Connect(function()
			Checked = not Checked
			TweenService:Create(InnerCheck, TweenInfo.new(0.2), {BackgroundTransparency = Checked and 0 or 1}):Play()
			if callback then callback(Checked) end
		end)
	end

	--// Элемент: Slider (Слайдер) //--
	function Window:Slider(text, min, max, default, callback)
		local Value = default or min
		
		local SliderFrame = Instance.new("Frame")
		SliderFrame.Size = UDim2.new(1, 0, 0, 50) -- Чуть выше для полоски
		SliderFrame.BackgroundColor3 = Theme.Element
		SliderFrame.Parent = Container
		AddCorner(SliderFrame)

		local Title = Instance.new("TextLabel")
		Title.Size = UDim2.new(1, -20, 0, 20)
		Title.Position = UDim2.new(0, 10, 0, 5)
		Title.BackgroundTransparency = 1
		Title.Text = text
		Title.TextColor3 = Theme.Text
		Title.Font = Theme.Font
		Title.TextSize = 14
		Title.TextXAlignment = Enum.TextXAlignment.Left
		Title.Parent = SliderFrame
		
		local ValueLabel = Instance.new("TextLabel")
		ValueLabel.Size = UDim2.new(0, 50, 0, 20)
		ValueLabel.Position = UDim2.new(1, -60, 0, 5)
		ValueLabel.BackgroundTransparency = 1
		ValueLabel.Text = tostring(Value)
		ValueLabel.TextColor3 = Theme.SubText
		ValueLabel.Font = Theme.Font
		ValueLabel.TextSize = 14
		ValueLabel.TextXAlignment = Enum.TextXAlignment.Right
		ValueLabel.Parent = SliderFrame

		local SliderBg = Instance.new("Frame")
		SliderBg.Size = UDim2.new(1, -20, 0, 6)
		SliderBg.Position = UDim2.new(0, 10, 0, 35)
		SliderBg.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
		SliderBg.Parent = SliderFrame
		AddCorner(SliderBg, UDim.new(1, 0))

		local SliderFill = Instance.new("Frame")
		SliderFill.Size = UDim2.new((Value - min) / (max - min), 0, 1, 0)
		SliderFill.BackgroundColor3 = Theme.Accent
		SliderFill.Parent = SliderBg
		AddCorner(SliderFill, UDim.new(1, 0))

		local Trigger = Instance.new("TextButton")
		Trigger.Size = UDim2.new(1, 0, 1, 0)
		Trigger.BackgroundTransparency = 1
		Trigger.Text = ""
		Trigger.Parent = SliderBg

		local isDragging = false

		local function UpdateSlider(input)
			local pos = UDim2.new(math.clamp((input.Position.X - SliderBg.AbsolutePosition.X) / SliderBg.AbsoluteSize.X, 0, 1), 0, 1, 0)
			TweenService:Create(SliderFill, TweenInfo.new(0.1), {Size = pos}):Play()
			
			local newValue = math.floor(((pos.X.Scale * (max - min)) + min))
			ValueLabel.Text = tostring(newValue)
			if callback then callback(newValue) end
		end

		Trigger.InputBegan:Connect(function(input)
			if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
				isDragging = true
				UpdateSlider(input)
			end
		end)

		UserInputService.InputChanged:Connect(function(input)
			if isDragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
				UpdateSlider(input)
			end
		end)

		UserInputService.InputEnded:Connect(function(input)
			if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
				isDragging = false
			end
		end)
	end
	
	--// Элемент: Input (Поле ввода) //--
	function Window:Input(text, placeholder, callback)
		local InputFrame = Instance.new("Frame")
		InputFrame.Size = UDim2.new(1, 0, 0, 40)
		InputFrame.BackgroundColor3 = Theme.Element
		InputFrame.Parent = Container
		AddCorner(InputFrame)
		
		local Title = Instance.new("TextLabel")
		Title.Size = UDim2.new(0.4, 0, 1, 0)
		Title.Position = UDim2.new(0, 10, 0, 0)
		Title.BackgroundTransparency = 1
		Title.Text = text
		Title.TextColor3 = Theme.Text
		Title.Font = Theme.Font
		Title.TextSize = 14
		Title.TextXAlignment = Enum.TextXAlignment.Left
		Title.Parent = InputFrame
		
		local TextBoxBg = Instance.new("Frame")
		TextBoxBg.Size = UDim2.new(0.5, 0, 0.7, 0)
		TextBoxBg.Position = UDim2.new(0.45, 0, 0.15, 0)
		TextBoxBg.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
		TextBoxBg.Parent = InputFrame
		AddCorner(TextBoxBg, UDim.new(0, 4))
		
		local Box = Instance.new("TextBox")
		Box.Size = UDim2.new(1, -10, 1, 0)
		Box.Position = UDim2.new(0, 5, 0, 0)
		Box.BackgroundTransparency = 1
		Box.Text = ""
		Box.PlaceholderText = placeholder or "Enter text..."
		Box.TextColor3 = Theme.Text
		Box.PlaceholderColor3 = Theme.SubText
		Box.Font = Theme.Font
		Box.TextSize = 14
		Box.Parent = TextBoxBg
		
		Box.FocusLost:Connect(function()
			if callback then callback(Box.Text) end
		end)
	end

	--// Элемент: Dropdown (Выпадающий список) //--
	function Window:Dropdown(text, options, callback)
		local DropFrame = Instance.new("Frame")
		DropFrame.Size = UDim2.new(1, 0, 0, 35) -- Начальная высота
		DropFrame.BackgroundColor3 = Theme.Element
		DropFrame.Parent = Container
		AddCorner(DropFrame)
		
		local Open = false
		local DropHeight = 35
		
		local Title = Instance.new("TextLabel")
		Title.Size = UDim2.new(1, -40, 0, 35)
		Title.Position = UDim2.new(0, 10, 0, 0)
		Title.BackgroundTransparency = 1
		Title.Text = text .. " (Select)"
		Title.TextColor3 = Theme.Text
		Title.Font = Theme.Font
		Title.TextSize = 14
		Title.TextXAlignment = Enum.TextXAlignment.Left
		Title.Parent = DropFrame
		
		local Arrow = Instance.new("TextLabel")
		Arrow.Size = UDim2.new(0, 30, 0, 35)
		Arrow.Position = UDim2.new(1, -30, 0, 0)
		Arrow.BackgroundTransparency = 1
		Arrow.Text = "v"
		Arrow.TextColor3 = Theme.SubText
		Arrow.Font = Enum.Font.GothamBold
		Arrow.Parent = DropFrame
		
		local OptionContainer = Instance.new("Frame")
		OptionContainer.Size = UDim2.new(1, -10, 0, 0)
		OptionContainer.Position = UDim2.new(0, 5, 0, 35)
		OptionContainer.BackgroundTransparency = 1
		OptionContainer.ClipsDescendants = true
		OptionContainer.Parent = DropFrame
		
		local OptionList = Instance.new("UIListLayout")
		OptionList.Padding = UDim.new(0, 2)
		OptionList.Parent = OptionContainer
		
		-- Создание кнопок для опций
		for _, option in pairs(options) do
			local OptBtn = Instance.new("TextButton")
			OptBtn.Size = UDim2.new(1, 0, 0, 25)
			OptBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
			OptBtn.Text = option
			OptBtn.TextColor3 = Theme.SubText
			OptBtn.Font = Theme.Font
			OptBtn.TextSize = 13
			OptBtn.Parent = OptionContainer
			AddCorner(OptBtn, UDim.new(0, 4))
			
			OptBtn.MouseButton1Click:Connect(function()
				Title.Text = text .. ": " .. option
				if callback then callback(option) end
				-- Закрыть после выбора
				Open = false
				Arrow.Text = "v"
				TweenService:Create(DropFrame, TweenInfo.new(0.3), {Size = UDim2.new(1, 0, 0, 35)}):Play()
				TweenService:Create(OptionContainer, TweenInfo.new(0.3), {Size = UDim2.new(1, -10, 0, 0)}):Play()
			end)
		end
		
		local TotalOptionsHeight = (#options * 27) + 5
		
		local Trigger = Instance.new("TextButton")
		Trigger.Size = UDim2.new(1, 0, 0, 35)
		Trigger.BackgroundTransparency = 1
		Trigger.Text = ""
		Trigger.Parent = DropFrame
		
		Trigger.MouseButton1Click:Connect(function()
			Open = not Open
			Arrow.Text = Open and "^" or "v"
			
			if Open then
				TweenService:Create(DropFrame, TweenInfo.new(0.3), {Size = UDim2.new(1, 0, 0, 35 + TotalOptionsHeight)}):Play()
				TweenService:Create(OptionContainer, TweenInfo.new(0.3), {Size = UDim2.new(1, -10, 0, TotalOptionsHeight)}):Play()
			else
				TweenService:Create(DropFrame, TweenInfo.new(0.3), {Size = UDim2.new(1, 0, 0, 35)}):Play()
				TweenService:Create(OptionContainer, TweenInfo.new(0.3), {Size = UDim2.new(1, -10, 0, 0)}):Play()
			end
		end)
	end

	return Window
end

return Library
