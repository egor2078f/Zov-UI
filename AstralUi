--[[ 
    RAVION UI LIBRARY REPLICA
    Design: Dark, Rounded, Mobile & PC Supported
]]

local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local Players = game:GetService("Players")
local Mouse = Players.LocalPlayer:GetMouse()

local Library = {}

-- Utility Functions
local function MakeDraggable(topbarobject, object)
	local Dragging = nil
	local DragInput = nil
	local DragStart = nil
	local StartPosition = nil

	local function Update(input)
		local Delta = input.Position - DragStart
		local pos = UDim2.new(StartPosition.X.Scale, StartPosition.X.Offset + Delta.X, StartPosition.Y.Scale, StartPosition.Y.Offset + Delta.Y)
		object.Position = pos
	end

	topbarobject.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			Dragging = true
			DragStart = input.Position
			StartPosition = object.Position

			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					Dragging = false
				end
			end)
		end
	end)

	topbarobject.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			DragInput = input
		end
	end)

	UserInputService.InputChanged:Connect(function(input)
		if input == DragInput and Dragging then
			Update(input)
		end
	end)
end

-- Create Window
function Library:CreateWindow(Config)
    local TitleText = Config.Title or "RAVION"
    local SubTitleText = Config.SubTitle or "v1.1"

    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "RavionUI"
    -- Защита от обнаружения (если нужно) или просто в PlayerGui
    if RunService:IsStudio() then
        ScreenGui.Parent = Players.LocalPlayer:WaitForChild("PlayerGui")
    else
        pcall(function()
            ScreenGui.Parent = CoreGui
        end)
        if not ScreenGui.Parent then ScreenGui.Parent = Players.LocalPlayer:WaitForChild("PlayerGui") end
    end

    local MainFrame = Instance.new("Frame")
    MainFrame.Name = "MainFrame"
    MainFrame.Parent = ScreenGui
    MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 24) -- Темный фон
    MainFrame.Position = UDim2.new(0.5, -159, 0.5, -110) -- Центр
    MainFrame.Size = UDim2.new(0, 318, 0, 220) -- Твой размер
    MainFrame.BorderSizePixel = 0

    local MainCorner = Instance.new("UICorner")
    MainCorner.CornerRadius = UDim.new(0, 12)
    MainCorner.Parent = MainFrame

    -- Header (Logo + Tabs container)
    local Header = Instance.new("Frame")
    Header.Name = "Header"
    Header.Parent = MainFrame
    Header.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    Header.BackgroundTransparency = 1
    Header.Size = UDim2.new(1, 0, 0, 80) -- Верхняя часть

    -- Logo R
    local LogoR = Instance.new("TextLabel")
    LogoR.Name = "LogoR"
    LogoR.Parent = Header
    LogoR.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    LogoR.BackgroundTransparency = 1
    LogoR.Position = UDim2.new(0, 15, 0, 10)
    LogoR.Size = UDim2.new(0, 20, 0, 30)
    LogoR.Font = Enum.Font.GothamBold
    LogoR.Text = "R"
    LogoR.TextColor3 = Color3.fromRGB(255, 60, 60) -- Красный акцент
    LogoR.TextSize = 28
    LogoR.TextXAlignment = Enum.TextXAlignment.Left

    -- Title Rest
    local LogoText = Instance.new("TextLabel")
    LogoText.Name = "LogoText"
    LogoText.Parent = Header
    LogoText.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    LogoText.BackgroundTransparency = 1
    LogoText.Position = UDim2.new(0, 35, 0, 14)
    LogoText.Size = UDim2.new(0, 100, 0, 25)
    LogoText.Font = Enum.Font.GothamBold
    LogoText.Text = string.upper(TitleText) .. " " .. SubTitleText
    LogoText.TextColor3 = Color3.fromRGB(150, 150, 150)
    LogoText.TextSize = 14
    LogoText.TextXAlignment = Enum.TextXAlignment.Left

    -- Made by text
    local MadeBy = Instance.new("TextLabel")
    MadeBy.Parent = Header
    MadeBy.BackgroundTransparency = 1
    MadeBy.Position = UDim2.new(0, 15, 0, 35)
    MadeBy.Size = UDim2.new(0, 100, 0, 15)
    MadeBy.Font = Enum.Font.Gotham
    MadeBy.Text = "made by user"
    MadeBy.TextColor3 = Color3.fromRGB(80, 80, 80)
    MadeBy.TextSize = 10
    MadeBy.TextXAlignment = Enum.TextXAlignment.Left

    -- Close Button
    local CloseBtn = Instance.new("TextButton")
    CloseBtn.Parent = MainFrame
    CloseBtn.BackgroundTransparency = 1
    CloseBtn.Position = UDim2.new(1, -30, 0, 10)
    CloseBtn.Size = UDim2.new(0, 20, 0, 20)
    CloseBtn.Font = Enum.Font.GothamBold
    CloseBtn.Text = "X"
    CloseBtn.TextColor3 = Color3.fromRGB(100, 100, 100)
    CloseBtn.TextSize = 14
    CloseBtn.MouseButton1Click:Connect(function()
        ScreenGui:Destroy()
    end)

    MakeDraggable(MainFrame, MainFrame)

    -- Tabs Container
    local TabButtonsContainer = Instance.new("Frame")
    TabButtonsContainer.Parent = Header
    TabButtonsContainer.BackgroundTransparency = 1
    TabButtonsContainer.Position = UDim2.new(0, 10, 0, 55)
    TabButtonsContainer.Size = UDim2.new(1, -20, 0, 30)

    local TabListLayout = Instance.new("UIListLayout")
    TabListLayout.Parent = TabButtonsContainer
    TabListLayout.FillDirection = Enum.FillDirection.Horizontal
    TabListLayout.SortOrder = Enum.SortOrder.LayoutOrder
    TabListLayout.Padding = UDim.new(0, 5)

    -- Content Container (Where elements go)
    local ContentContainer = Instance.new("Frame")
    ContentContainer.Parent = MainFrame
    ContentContainer.BackgroundTransparency = 1
    ContentContainer.Position = UDim2.new(0, 0, 0, 90)
    ContentContainer.Size = UDim2.new(1, 0, 1, -90)

    local Tabs = {}
    local FirstTab = true

    local Window = {}

    function Window:Tab(Name)
        -- Tab Button
        local TabBtn = Instance.new("TextButton")
        TabBtn.Name = Name .. "Btn"
        TabBtn.Parent = TabButtonsContainer
        TabBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
        TabBtn.Size = UDim2.new(0, 0, 1, 0) -- Width set automatic
        TabBtn.Font = Enum.Font.GothamMedium
        TabBtn.Text = Name
        TabBtn.TextColor3 = Color3.fromRGB(150, 150, 150)
        TabBtn.TextSize = 12
        TabBtn.AutoButtonColor = false
        
        -- Automatic Width for Tab Button
        local TextSize = game:GetService("TextService"):GetTextSize(Name, 12, Enum.Font.GothamMedium, Vector2.new(1000, 30))
        TabBtn.Size = UDim2.new(0, TextSize.X + 20, 1, 0)

        local TabCorner = Instance.new("UICorner")
        TabCorner.CornerRadius = UDim.new(1, 0)
        TabCorner.Parent = TabBtn

        -- Page (Scrolling Frame)
        local Page = Instance.new("ScrollingFrame")
        Page.Name = Name .. "Page"
        Page.Parent = ContentContainer
        Page.Active = true
        Page.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        Page.BackgroundTransparency = 1
        Page.BorderSizePixel = 0
        Page.Size = UDim2.new(1, 0, 1, 0)
        Page.ScrollBarThickness = 2
        Page.ScrollBarImageColor3 = Color3.fromRGB(255, 60, 60)
        Page.Visible = false 

        local PagePadding = Instance.new("UIPadding")
        PagePadding.PaddingLeft = UDim.new(0, 15)
        PagePadding.PaddingRight = UDim.new(0, 15)
        PagePadding.PaddingTop = UDim.new(0, 5)
        PagePadding.Parent = Page

        local PageLayout = Instance.new("UIListLayout")
        PageLayout.Parent = Page
        PageLayout.SortOrder = Enum.SortOrder.LayoutOrder
        PageLayout.Padding = UDim.new(0, 8)
        
        -- Update Canvas Size
        PageLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            Page.CanvasSize = UDim2.new(0, 0, 0, PageLayout.AbsoluteContentSize.Y + 10)
        end)

        -- Switch Logic
        if FirstTab then
            FirstTab = false
            Page.Visible = true
            TabBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
            TabBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
        end

        TabBtn.MouseButton1Click:Connect(function()
            for _, item in pairs(ContentContainer:GetChildren()) do
                if item:IsA("ScrollingFrame") then item.Visible = false end
            end
            for _, btn in pairs(TabButtonsContainer:GetChildren()) do
                if btn:IsA("TextButton") then
                    TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(30, 30, 35), TextColor3 = Color3.fromRGB(150, 150, 150)}):Play()
                end
            end
            
            Page.Visible = true
            TweenService:Create(TabBtn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(40, 40, 45), TextColor3 = Color3.fromRGB(255, 255, 255)}):Play()
        end)

        local TabElements = {}

        -- TOGGLE
        function TabElements:Toggle(Text, Default, Callback)
            local ToggleFrame = Instance.new("Frame")
            ToggleFrame.Name = "Toggle"
            ToggleFrame.Parent = Page
            ToggleFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
            ToggleFrame.Size = UDim2.new(1, 0, 0, 35)
            
            local TFCorner = Instance.new("UICorner")
            TFCorner.CornerRadius = UDim.new(0, 8)
            TFCorner.Parent = ToggleFrame

            local Label = Instance.new("TextLabel")
            Label.Parent = ToggleFrame
            Label.BackgroundTransparency = 1
            Label.Position = UDim2.new(0, 10, 0, 0)
            Label.Size = UDim2.new(1, -60, 1, 0)
            Label.Font = Enum.Font.Gotham
            Label.Text = Text
            Label.TextColor3 = Color3.fromRGB(200, 200, 200)
            Label.TextSize = 12
            Label.TextXAlignment = Enum.TextXAlignment.Left

            local SwitchInfo = Instance.new("TextButton")
            SwitchInfo.Parent = ToggleFrame
            SwitchInfo.BackgroundColor3 = Default and Color3.fromRGB(255, 60, 60) or Color3.fromRGB(50, 50, 55)
            SwitchInfo.Position = UDim2.new(1, -45, 0.5, -10)
            SwitchInfo.Size = UDim2.new(0, 40, 0, 20)
            SwitchInfo.Text = ""
            SwitchInfo.AutoButtonColor = false

            local SwitchCorner = Instance.new("UICorner")
            SwitchCorner.CornerRadius = UDim.new(1, 0)
            SwitchCorner.Parent = SwitchInfo

            local Circle = Instance.new("Frame")
            Circle.Parent = SwitchInfo
            Circle.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            Circle.Position = Default and UDim2.new(1, -18, 0.5, -8) or UDim2.new(0, 2, 0.5, -8)
            Circle.Size = UDim2.new(0, 16, 0, 16)
            
            local CircleCorner = Instance.new("UICorner")
            CircleCorner.CornerRadius = UDim.new(1, 0)
            CircleCorner.Parent = Circle

            local Toggled = Default
            
            SwitchInfo.MouseButton1Click:Connect(function()
                Toggled = not Toggled
                Callback(Toggled)
                
                if Toggled then
                    TweenService:Create(SwitchInfo, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(255, 60, 60)}):Play()
                    TweenService:Create(Circle, TweenInfo.new(0.2), {Position = UDim2.new(1, -18, 0.5, -8)}):Play()
                else
                    TweenService:Create(SwitchInfo, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(50, 50, 55)}):Play()
                    TweenService:Create(Circle, TweenInfo.new(0.2), {Position = UDim2.new(0, 2, 0.5, -8)}):Play()
                end
            end)
        end

        -- SLIDER
        function TabElements:Slider(Text, Min, Max, Default, Callback)
            local SliderFrame = Instance.new("Frame")
            SliderFrame.Name = "Slider"
            SliderFrame.Parent = Page
            SliderFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
            SliderFrame.Size = UDim2.new(1, 0, 0, 50)

            local SFCorner = Instance.new("UICorner")
            SFCorner.CornerRadius = UDim.new(0, 8)
            SFCorner.Parent = SliderFrame

            local Label = Instance.new("TextLabel")
            Label.Parent = SliderFrame
            Label.BackgroundTransparency = 1
            Label.Position = UDim2.new(0, 10, 0, 5)
            Label.Size = UDim2.new(1, -20, 0, 20)
            Label.Font = Enum.Font.Gotham
            Label.Text = Text
            Label.TextColor3 = Color3.fromRGB(200, 200, 200)
            Label.TextSize = 12
            Label.TextXAlignment = Enum.TextXAlignment.Left

            local ValueLabel = Instance.new("TextLabel")
            ValueLabel.Parent = SliderFrame
            ValueLabel.BackgroundTransparency = 1
            ValueLabel.Position = UDim2.new(1, -40, 0, 5)
            ValueLabel.Size = UDim2.new(0, 30, 0, 20)
            ValueLabel.Font = Enum.Font.GothamBold
            ValueLabel.Text = tostring(Default)
            ValueLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
            ValueLabel.TextSize = 12

            local SliderBar = Instance.new("TextButton")
            SliderBar.Parent = SliderFrame
            SliderBar.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
            SliderBar.Position = UDim2.new(0, 10, 0, 30)
            SliderBar.Size = UDim2.new(1, -20, 0, 6)
            SliderBar.Text = ""
            SliderBar.AutoButtonColor = false

            local BarCorner = Instance.new("UICorner")
            BarCorner.CornerRadius = UDim.new(1, 0)
            BarCorner.Parent = SliderBar

            local Fill = Instance.new("Frame")
            Fill.Parent = SliderBar
            Fill.BackgroundColor3 = Color3.fromRGB(255, 60, 60)
            Fill.Size = UDim2.new((Default - Min) / (Max - Min), 0, 1, 0)
            
            local FillCorner = Instance.new("UICorner")
            FillCorner.CornerRadius = UDim.new(1, 0)
            FillCorner.Parent = Fill

            local Dragging = false
            
            local function UpdateSlider(Input)
                local SizeX = math.clamp((Input.Position.X - SliderBar.AbsolutePosition.X) / SliderBar.AbsoluteSize.X, 0, 1)
                local Value = math.floor(Min + ((Max - Min) * SizeX))
                
                TweenService:Create(Fill, TweenInfo.new(0.1), {Size = UDim2.new(SizeX, 0, 1, 0)}):Play()
                ValueLabel.Text = tostring(Value)
                Callback(Value)
            end

            SliderBar.InputBegan:Connect(function(Input)
                if Input.UserInputType == Enum.UserInputType.MouseButton1 or Input.UserInputType == Enum.UserInputType.Touch then
                    Dragging = true
                    UpdateSlider(Input)
                end
            end)

            UserInputService.InputEnded:Connect(function(Input)
                if Input.UserInputType == Enum.UserInputType.MouseButton1 or Input.UserInputType == Enum.UserInputType.Touch then
                    Dragging = false
                end
            end)

            UserInputService.InputChanged:Connect(function(Input)
                if Dragging and (Input.UserInputType == Enum.UserInputType.MouseMovement or Input.UserInputType == Enum.UserInputType.Touch) then
                    UpdateSlider(Input)
                end
            end)
        end
        
        -- COLOR PICKER (Visual)
        function TabElements:ColorPicker(Text, Default, Callback)
            local PickerFrame = Instance.new("Frame")
            PickerFrame.Name = "ColorPicker"
            PickerFrame.Parent = Page
            PickerFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
            PickerFrame.Size = UDim2.new(1, 0, 0, 35)
            
            local PFCorner = Instance.new("UICorner")
            PFCorner.CornerRadius = UDim.new(0, 8)
            PFCorner.Parent = PickerFrame
            
            local Label = Instance.new("TextLabel")
            Label.Parent = PickerFrame
            Label.BackgroundTransparency = 1
            Label.Position = UDim2.new(0, 10, 0, 0)
            Label.Size = UDim2.new(1, -50, 1, 0)
            Label.Font = Enum.Font.Gotham
            Label.Text = Text
            Label.TextColor3 = Color3.fromRGB(200, 200, 200)
            Label.TextSize = 12
            Label.TextXAlignment = Enum.TextXAlignment.Left
            
            local ColorPreview = Instance.new("TextButton")
            ColorPreview.Parent = PickerFrame
            ColorPreview.BackgroundColor3 = Default
            ColorPreview.Position = UDim2.new(1, -35, 0.5, -10)
            ColorPreview.Size = UDim2.new(0, 25, 0, 20)
            ColorPreview.Text = ""
            
            local CPCorner = Instance.new("UICorner")
            CPCorner.CornerRadius = UDim.new(0, 4)
            CPCorner.Parent = ColorPreview
            
            -- Picker Popup Logic
            local IsOpen = false
            local Popup = Instance.new("Frame")
            Popup.Parent = ScreenGui -- Parent to screen to be on top
            Popup.Size = UDim2.new(0, 200, 0, 150)
            Popup.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
            Popup.Visible = false
            Popup.ZIndex = 10
            
            local PopupCorner = Instance.new("UICorner")
            PopupCorner.CornerRadius = UDim.new(0, 8)
            PopupCorner.Parent = Popup
            
            -- Hue Slider (Rainbow)
            local HueBar = Instance.new("ImageButton")
            HueBar.Parent = Popup
            HueBar.Position = UDim2.new(0, 10, 0, 10)
            HueBar.Size = UDim2.new(0, 180, 0, 20)
            HueBar.Image = "rbxassetid://4018903152" -- Rainbow Gradient
            
            local HueTracker = Instance.new("Frame")
            HueTracker.Parent = HueBar
            HueTracker.BackgroundColor3 = Color3.new(1,1,1)
            HueTracker.Size = UDim2.new(0, 2, 1, 0)
            HueTracker.BorderSizePixel = 0
            
            -- Sat/Val logic is complex, simplify to Hue for this request or basic preset
            -- Let's stick to HUE selection + Predefined Value/Sat for simplicity in "Ravion" style
            
            local Hue = 0
            local Sat = 1
            local Val = 1
            
            local function UpdateColor()
                local NewColor = Color3.fromHSV(Hue, Sat, Val)
                ColorPreview.BackgroundColor3 = NewColor
                Callback(NewColor)
            end
            
            local DraggingHue = false
            
            HueBar.InputBegan:Connect(function(input)
                 if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    DraggingHue = true
                 end
            end)
            
            UserInputService.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    DraggingHue = false
                end
            end)
            
            UserInputService.InputChanged:Connect(function(input)
                if DraggingHue and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                    local RelX = math.clamp((input.Position.X - HueBar.AbsolutePosition.X) / HueBar.AbsoluteSize.X, 0, 1)
                    HueTracker.Position = UDim2.new(RelX, 0, 0, 0)
                    Hue = 1 - RelX
                    UpdateColor()
                end
            end)
            
            -- Close Button on Popup
            local ClosePick = Instance.new("TextButton")
            ClosePick.Parent = Popup
            ClosePick.Size = UDim2.new(1, -20, 0, 25)
            ClosePick.Position = UDim2.new(0, 10, 1, -35)
            ClosePick.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
            ClosePick.Text = "Confirm"
            ClosePick.TextColor3 = Color3.white
            
            local CC = Instance.new("UICorner"); CC.Parent = ClosePick
            
            ClosePick.MouseButton1Click:Connect(function()
                IsOpen = false
                Popup.Visible = false
            end)
            
            ColorPreview.MouseButton1Click:Connect(function()
                IsOpen = not IsOpen
                Popup.Visible = IsOpen
                Popup.Position = UDim2.new(0, MainFrame.AbsolutePosition.X + 330, 0, MainFrame.AbsolutePosition.Y)
            end)
        end

        return TabElements
    end

    return Window
end

return Library
